(* -*- tuareg -*- *)
open Jbuild_plugin.V1

let extra_flags =
  match Sys.getenv "JBUILD_STATIC" with
  | "true" -> "-cclib -static"
  | x -> failwith (Printf.sprintf "JBUILD_STATIC: unknown value %S" x)
  | exception Not_found -> ""

let sexp = Printf.sprintf "
  (jbuild_version 1) \
  \
  (executables ( \
    (names (main)) \
    (libraries (capTP mirage-clock-unix mirage-logs)) \
    (flags (:standard %s)) \
  )) \
" extra_flags

let () =
  send sexp
